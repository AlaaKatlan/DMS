<div class="book-detail-page" dir="rtl" *ngIf="book; else loadingTpl">
  <div class="page-header">
    <div class="header-content">
      <button routerLink="/books" class="btn-back">
        <lucide-angular name="arrow-right" [size]="20"></lucide-angular>
        العودة للمكتبة
      </button>
      <h1 class="page-title">{{ book.title }}</h1>
      <span class="stock-badge" [ngClass]="getStockClass(book.stock_quantity || 0)">
        {{ getStockStatus(book.stock_quantity || 0) }}
      </span>
    </div>

    <div class="header-actions">
      <button [routerLink]="['/books', book.book_id, 'edit']" class="btn btn-outline">
        <lucide-angular name="edit-3" [size]="18"></lucide-angular>
        تعديل
      </button>
      <button (click)="deleteBook()" class="btn btn-danger-outline">
        <lucide-angular name="trash-2" [size]="18"></lucide-angular>
        حذف
      </button>
    </div>
  </div>

  <div class="content-grid">
    <div class="card cover-card">
      <div class="cover-wrapper">
        <img alt=""
          [src]="book.cover_image_url || 'assets/images/book-placeholder.png'"
          [alt]="book.title"
          class="book-cover"
        >
      </div>
    </div>

    <div class="card info-card">
      <div class="card-header">
        <h3>معلومات الكتاب</h3>
      </div>
      <div class="info-list">
        <div class="info-item">
          <span class="label">المؤلف</span>
          <span class="value">{{ book.author || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">ISBN</span>
          <span class="value font-mono">{{ book.isbn || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">الناشر</span>
          <span class="value">{{ book.publisher || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">سنة النشر</span>
          <span class="value">{{ book.year || '-' }}</span>
        </div>
      </div>

      <div class="separator"></div>

      <div class="description-section">
        <h4>نبذة عن الكتاب</h4>
        <p>{{ book.description || 'لا يوجد وصف متاح.' }}</p>
      </div>
    </div>

    <div class="card stats-card">
      <div class="card-header">
        <h3>البيانات المالية والمخزون</h3>
      </div>
      <div class="stats-grid">
        <div class="stat-box">
          <lucide-angular name="dollar-sign" [size]="20" class="text-blue-500"></lucide-angular>
          <div class="stat-info">
            <span class="label">سعر البيع (USD)</span>
            <span class="val">{{ book.price_usd | currency:'USD' }}</span>
          </div>
        </div>
        <div class="stat-box">
          <lucide-angular name="trending-down" [size]="20" class="text-orange-500"></lucide-angular>
          <div class="stat-info">
            <span class="label">التكلفة (USD)</span>
            <span class="val">{{ book.cost_usd | currency:'USD' }}</span>
          </div>
        </div>
        <div class="stat-box">
          <lucide-angular name="package" [size]="20" class="text-green-500"></lucide-angular>
          <div class="stat-info">
            <span class="label">الكمية الحالية</span>
            <span class="val">{{ book.stock_quantity || 0 }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading-container">
    <div class="spinner"></div>
    <p>جاري تحميل بيانات الكتاب...</p>
  </div>
</ng-template>
