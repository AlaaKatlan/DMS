<div class="book-form-page" dir="rtl">
  <div class="form-container">
    <div class="form-header">
      <div class="header-content">
        <button routerLink="/books" class="btn-back">
          <lucide-angular name="arrow-right" [size]="24"></lucide-angular>
        </button>
        <div class="title-group">
          <h2>{{ isEditMode ? 'تعديل بيانات الكتاب' : 'إضافة كتاب جديد' }}</h2>
          <p class="subtitle">
            {{ isEditMode ? 'ID: ' + bookId : 'إدخال كتاب جديد للمكتبة' }}
          </p>
        </div>
      </div>

      <div class="header-actions">
        <button type="button" routerLink="/books" class="btn btn-secondary">إلغاء</button>
        <button (click)="onSubmit()" [disabled]="bookForm.invalid || isSubmitting" class="btn btn-primary">
          <lucide-angular *ngIf="isSubmitting" name="loader-2" class="animate-spin" [size]="18"></lucide-angular>
          <span>{{ isSubmitting ? 'جاري الحفظ...' : 'حفظ البيانات' }}</span>
        </button>
      </div>
    </div>

    <form [formGroup]="bookForm" class="form-grid">

      <div class="main-column">

        <div class="card">
          <div class="card-header">
            <lucide-angular name="book" [size]="20"></lucide-angular>
            <h3>المعلومات الأساسية</h3>
          </div>

          <div class="card-body grid-2">
            <div class="form-group col-span-2">
              <label>عنوان الكتاب <span class="required">*</span></label>
              <input formControlName="title" type="text" placeholder="أدخل العنوان كاملاً">
            </div>

            <div class="form-group">
              <label>المؤلف</label>
              <input formControlName="author" type="text">
            </div>

            <div class="form-group">
              <label>الناشر</label>
              <input formControlName="publisher" type="text">
              <span class="hint">الافتراضي: دار الزيبق</span>
            </div>

            <div class="form-group">
              <label>التصنيف</label>
              <input formControlName="category" type="text">
            </div>

            <div class="form-group">
              <label>ISBN</label>
              <input formControlName="isbn" type="text" class="font-mono">
            </div>

            <div class="form-group">
              <label>سنة النشر</label>
              <input formControlName="year" type="number">
            </div>

            <div class="form-group">
              <label>الدولة</label>
              <select formControlName="country_id">
                <option [ngValue]="null">اختر الدولة</option>
                <option *ngFor="let c of countries" [value]="c.id">{{ c.name }}</option>
              </select>
            </div>
          </div>

          <div class="card-body">
            <div class="form-group">
              <label>وصف الكتاب</label>
              <textarea formControlName="description" rows="3"></textarea>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <lucide-angular name="dollar-sign" [size]="20" class="text-success"></lucide-angular>
            <h3>أسعار المبيع</h3>
          </div>
          <div class="card-body grid-4">
            <div class="form-group">
              <label>USD ($)</label>
              <input formControlName="price_usd" type="number" class="font-bold text-success">
            </div>
            <div class="form-group">
              <label>ليرة سورية</label>
              <input formControlName="price_syp" type="number">
            </div>
            <div class="form-group">
              <label>درهم (AED)</label>
              <input formControlName="price_aed" type="number">
            </div>
            <div class="form-group">
              <label>ريال (QR)</label>
              <input formControlName="price_qr" type="number" class="bg-readonly" readonly title="تلقائي">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <lucide-angular name="trending-down" [size]="20" class="text-warning"></lucide-angular>
            <h3>التكلفة والمخزون</h3>
          </div>
          <div class="card-body grid-3">
            <div class="form-group">
              <label>التكلفة (USD)</label>
              <input formControlName="cost_usd" type="number">
            </div>
            <div class="form-group">
              <label>التكلفة (SYP)</label>
              <input formControlName="cost_syp" type="number">
            </div>
            <div class="form-group">
              <label>الكمية المتوفرة</label>
              <input formControlName="quantity" type="number" class="font-bold">
            </div>
          </div>
        </div>
      </div>

      <div class="side-column">

        <div class="card">
          <div class="card-header">
            <lucide-angular name="ruler" [size]="20" class="text-info"></lucide-angular>
            <h3>المواصفات الفنية</h3>
          </div>
          <div class="card-body">
            <div class="grid-2">
              <div class="form-group">
                <label>الطول (cm)</label>
                <input formControlName="height_cm" type="number">
              </div>
              <div class="form-group">
                <label>العرض (cm)</label>
                <input formControlName="width_cm" type="number">
              </div>
            </div>
            <div class="form-group mt-3">
              <label>عدد الصفحات</label>
              <input formControlName="pages" type="number">
            </div>
            <div class="form-group mt-3">
              <label>نوع الغلاف</label>
              <select formControlName="cover_type">
                <option value="">اختر النوع</option>
                <option value="hardcover">غلاف فني (Hardcover)</option>
                <option value="paperback">غلاف عادي (Paperback)</option>
                <option value="leather">جلد (Leather)</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <lucide-angular name="image" [size]="20" class="text-primary"></lucide-angular>
            <h3>الملفات والصور</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>رابط صورة الغلاف</label>
              <input formControlName="cover_image_url" type="text" placeholder="https://...">
            </div>

            <div *ngIf="bookForm.get('cover_image_url')?.value" class="image-preview">
              <img [src]="bookForm.get('cover_image_url')?.value" alt="Preview">
            </div>

            <div class="form-group mt-3">
              <label>لاحقة الصورة</label>
              <input formControlName="cover_image_extention" type="text" placeholder=".jpg">
            </div>
            <div class="form-group mt-3">
              <label>رابط الملف (PDF)</label>
              <input formControlName="file_url" type="text" placeholder="https://...">
            </div>
          </div>
        </div>

      </div>
    </form>
  </div>
</div>
