<!-- src/app/features/books/components/book-list/book-list.component.html -->
<div class="books-page" dir="rtl">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">إدارة الكتب</h1>
      <p class="page-subtitle">إدارة الكتب والمخزون بشكل فعّال</p>
    </div>
    <button routerLink="/books/new" class="btn btn-primary">
      <lucide-angular name="plus" [size]="20"></lucide-angular>
      <span>إضافة كتاب جديد</span>
    </button>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="search-box">
      <lucide-angular name="search" [size]="20"></lucide-angular>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (ngModelChange)="applyFilters()"
        placeholder="ابحث عن كتاب، مؤلف، أو ISBN..."
      />
    </div>

    <div class="filters">
      <div class="view-mode-toggle">
        <button
          (click)="viewMode = 'grid'"
          [class.active]="viewMode === 'grid'"
          title="عرض شبكة"
        >
          <lucide-angular name="grid" [size]="20"></lucide-angular>
        </button>
        <button
          (click)="viewMode = 'list'"
          [class.active]="viewMode === 'list'"
          title="عرض قائمة"
        >
          <lucide-angular name="list" [size]="20"></lucide-angular>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>جاري تحميل الكتب...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && filteredBooks.length === 0" class="empty-state">
    <lucide-angular name="book-open" [size]="64"></lucide-angular>
    <h3>لا توجد كتب</h3>
    <p>{{ searchQuery ? 'لا توجد نتائج تطابق بحثك' : 'ابدأ بإضافة كتاب جديد' }}</p>
    <button *ngIf="!searchQuery" routerLink="/books/new" class="btn btn-primary">
      <lucide-angular name="plus" [size]="18"></lucide-angular>
      <span>إضافة كتاب</span>
    </button>
  </div>

  <!-- Grid View -->
  <div *ngIf="!loading && filteredBooks.length > 0 && viewMode === 'grid'" class="books-grid">
    <div *ngFor="let book of filteredBooks" class="book-card">
      <!-- Book Cover -->
      <div class="book-cover">
        <img alt=""
          *ngIf="book.cover_image_url"
          [src]="book.cover_image_url"
          [alt]="book.title"
        />
        <div *ngIf="!book.cover_image_url" class="no-image">
          <lucide-angular name="book-open" [size]="48"></lucide-angular>
          <p>لا توجد صورة</p>
        </div>

        <!-- Stock Badge (optional) -->
        <!-- <div *ngIf="bookStocks.has(book.book_id)"
             class="stock-badge"
             [ngClass]="getStockClass(getBookStock(book.book_id))">
          {{ getStockStatus(getBookStock(book.book_id)) }}
        </div> -->
      </div>

      <!-- Book Info -->
      <div class="book-info">
        <h3 class="book-title" [title]="book.title">{{ book.title }}</h3>
        <p class="book-author">{{ book.author || 'مؤلف غير معروف' }}</p>

        <div class="book-details">
          <div class="detail-row" *ngIf="book.publisher">
            <lucide-angular name="building" [size]="16"></lucide-angular>
            <span>{{ book.publisher }}</span>
          </div>
          <div class="detail-row" *ngIf="book.isbn">
            <lucide-angular name="hash" [size]="16"></lucide-angular>
            <span>{{ book.isbn }}</span>
          </div>
          <div class="detail-row" *ngIf="book.category">
            <lucide-angular name="tag" [size]="16"></lucide-angular>
            <span>{{ book.category }}</span>
          </div>
        </div>

        <div class="book-price">{{ formatPrice(book.price_usd, 'USD') }}</div>
      </div>

      <!-- Actions -->
      <div class="book-actions">
        <button [routerLink]="['/books', book.book_id]">
          <lucide-angular name="eye" [size]="16"></lucide-angular>
          <span>عرض</span>
        </button>
        <button [routerLink]="['/books', book.book_id, 'edit']">
          <lucide-angular name="edit" [size]="16"></lucide-angular>
          <span>تعديل</span>
        </button>
        <button class="delete" (click)="deleteBook(book)">
          <lucide-angular name="trash-2" [size]="16"></lucide-angular>
          <span>حذف</span>
        </button>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div *ngIf="!loading && filteredBooks.length > 0 && viewMode === 'list'" class="books-table">
    <table>
      <thead>
        <tr>
          <th>الغلاف</th>
          <th>العنوان</th>
          <th>المؤلف</th>
          <th>ISBN</th>
          <th>الفئة</th>
          <th>السعر</th>
          <th>الإجراءات</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let book of filteredBooks">
          <td class="book-cover-cell">
            <img alt="" *ngIf="book.cover_image_url" [src]="book.cover_image_url" [alt]="book.title" />
            <div *ngIf="!book.cover_image_url" class="no-image-small">
              <lucide-angular name="book-open" [size]="24"></lucide-angular>
            </div>
          </td>
          <td class="book-title-cell">{{ book.title }}</td>
          <td>{{ book.author || '-' }}</td>
          <td>{{ book.isbn || '-' }}</td>
          <td>{{ book.category || '-' }}</td>
          <td class="book-price-cell">{{ formatPrice(book.price_usd, 'USD') }}</td>
          <td>
            <div class="table-actions">
              <button [routerLink]="['/books', book.book_id]" title="عرض">
                <lucide-angular name="eye" [size]="16"></lucide-angular>
              </button>
              <button [routerLink]="['/books', book.book_id, 'edit']" title="تعديل">
                <lucide-angular name="edit" [size]="16"></lucide-angular>
              </button>
              <button class="delete" (click)="deleteBook(book)" title="حذف">
                <lucide-angular name="trash-2" [size]="16"></lucide-angular>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
