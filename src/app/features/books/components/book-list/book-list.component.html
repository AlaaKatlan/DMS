<div class="p-6" dir="rtl">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">المكتبة والمخزون</h1>
      <p class="text-gray-500">إدارة الكتب والكميات المتوفرة</p>
    </div>
    <button routerLink="/books/new" class="btn btn-primary flex items-center gap-2">
      <lucide-angular name="plus" [size]="20"></lucide-angular>
      إضافة كتاب
    </button>
  </div>

  <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex gap-4">
    <div class="relative flex-1">
      <lucide-angular name="search" class="absolute right-3 top-2.5 text-gray-400" [size]="20"></lucide-angular>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (ngModelChange)="applyFilters()"
        placeholder="ابحث عن كتاب، مؤلف، أو ISBN..."
        class="w-full pr-10 pl-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary"
      >
    </div>
    <div class="flex gap-2">
      <button (click)="viewMode = 'grid'" [class.bg-gray-100]="viewMode === 'grid'" class="p-2 rounded hover:bg-gray-100">
        <lucide-angular name="grid" [size]="20"></lucide-angular>
      </button>
      <button (click)="viewMode = 'list'" [class.bg-gray-100]="viewMode === 'list'" class="p-2 rounded hover:bg-gray-100">
        <lucide-angular name="list" [size]="20"></lucide-angular>
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="text-center py-10">
    <div class="spinner"></div>
    <p class="mt-2 text-gray-500">جاري تحميل الكتب...</p>
  </div>

  <div *ngIf="!loading">

    <div *ngIf="viewMode === 'grid'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <div *ngFor="let book of filteredBooks" class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden border">
        <div class="h-48 bg-gray-100 flex items-center justify-center relative">
            <span class="text-gray-400">لا توجد صورة</span>
            <!-- TO DO: إضافة دعم لتحميل وعرض صور الكتب -->
            <!-- <div class="absolute top-2 left-2 px-2 py-1 rounded text-xs font-medium" [ngClass]="getStockClass(book.stock_quantity || 0)">
                {{ getStockStatus(book.stock_quantity || 0) }}
            </div> -->
        </div>

        <div class="p-4">
          <h3 class="font-bold text-lg mb-1 truncate">{{ book.title }}</h3>
          <p class="text-sm text-gray-500 mb-3">{{ book.author }}</p>
<!-- TO DO: إعادة إضافة عداد المخزون عند تفعيل ميزة المخزون -->
          <!-- <div class="flex justify-between items-center mb-4">
            <span class="font-bold text-primary">{{ book.price_usd | currency:'USD' }}</span>
            <span class="text-sm text-gray-500">الكمية: {{ book.stock_quantity || 0 }}</span>
          </div> -->

          <div class="flex gap-2 border-t pt-3">
             <button [routerLink]="['/books', book.book_id]" class="flex-1 text-sm btn btn-outline">عرض</button>
             <button [routerLink]="['/books', book.book_id, 'edit']" class="p-2 text-blue-600 hover:bg-blue-50 rounded">
                <lucide-angular name="edit" [size]="16"></lucide-angular>
             </button>
             <button (click)="deleteBook(book)" class="p-2 text-red-600 hover:bg-red-50 rounded">
                <lucide-angular name="trash-2" [size]="16"></lucide-angular>
             </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="viewMode === 'list'" class="bg-white rounded-lg shadow overflow-hidden">
      <table class="w-full text-right">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="p-4">العنوان</th>
            <th class="p-4">المؤلف</th>
            <th class="p-4">ISBN</th>
            <th class="p-4">السعر</th>
            <th class="p-4">الكمية</th>
            <th class="p-4">الإجراءات</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of filteredBooks" class="border-b hover:bg-gray-50">
            <td class="p-4 font-medium">{{ book.title }}</td>
            <td class="p-4 text-gray-600">{{ book.author }}</td>
            <td class="p-4 text-gray-500">{{ book.isbn || '-' }}</td>
            <td class="p-4">{{ book.price_usd | currency:'USD' }}</td>
            <td class="p-4">
              <!-- TO DO: إعادة إضافة عداد المخزون عند تفعيل ميزة المخزون -->
                <!-- <span class="px-2 py-1 rounded text-xs" [ngClass]="getStockClass(book.stock_quantity || 0)">
                    {{ book.stock_quantity || 0 }}
                </span> -->
            </td>
            <td class="p-4 flex gap-2">
                <button [routerLink]="['/books', book.book_id]" class="text-blue-600 hover:underline">عرض</button>
                <button (click)="deleteBook(book)" class="text-red-600 hover:underline">حذف</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="filteredBooks.length === 0" class="text-center py-12">
        <lucide-angular name="book-open" class="mx-auto text-gray-300 mb-3" [size]="48"></lucide-angular>
        <p class="text-gray-500">لا توجد كتب تطابق بحثك</p>
    </div>
  </div>
</div>
