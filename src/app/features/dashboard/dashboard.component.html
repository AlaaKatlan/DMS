<!-- src/app/features/dashboard/dashboard.component.html -->

<div class="dashboard-container" dir="rtl">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="welcome-section">
      <h1 class="welcome-title">
        {{ getGreeting() }}ุ {{ currentUser?.full_name_p || 'ูุฑุญุจุงู' }}!
      </h1>
      <p class="welcome-subtitle">
        ุฅููู ููุฎุต ุดุงูู ูุนูููุงุช ุฏุงุฑ ุงูุฒูุจู ุงูููู
      </p>
    </div>

    <div class="quick-actions">
      <button class="btn btn-primary" routerLink="/projects/new">
        <lucide-angular name="folder" [size]="18"></lucide-angular>
        ูุดุฑูุน ุฌุฏูุฏ
      </button>
      <button class="btn btn-secondary" routerLink="/invoices/new">
        <lucide-angular name="file-text" [size]="18"></lucide-angular>
        ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
  </div>

  <!-- Stats Cards -->
  <div *ngIf="!loading && stats" class="stats-grid">
    <!-- Revenue Today -->
    <div class="stat-card revenue-card">
      <div class="stat-icon">
        <lucide-angular name="dollar-sign" [size]="24"></lucide-angular>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">ุฅูุฑุงุฏุงุช ุงูููู</h3>
        <p class="stat-value">{{ formatCurrency(stats.todayRevenue) }}</p>
        <span class="stat-trend positive">+12.5%</span>
      </div>
    </div>

    <!-- Monthly Revenue -->
    <div class="stat-card profit-card">
      <div class="stat-icon">
        <lucide-angular name="trending-up" [size]="24"></lucide-angular>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">ุฅูุฑุงุฏุงุช ุงูุดูุฑ</h3>
        <p class="stat-value">{{ formatCurrency(stats.monthlyRevenue) }}</p>
        <span class="stat-trend positive">+8.3%</span>
      </div>
    </div>

    <!-- Monthly Expenses -->
    <div class="stat-card expense-card">
      <div class="stat-icon">
        <lucide-angular name="arrow-down" [size]="24"></lucide-angular>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">ูุตุงุฑูู ุงูุดูุฑ</h3>
        <p class="stat-value">{{ formatCurrency(stats.monthlyExpenses) }}</p>
        <span class="stat-trend negative">-5.2%</span>
      </div>
    </div>

    <!-- Net Profit -->
    <div class="stat-card net-profit-card">
      <div class="stat-icon">
        <lucide-angular name="activity" [size]="24"></lucide-angular>
      </div>
      <div class="stat-content">
        <h3 class="stat-label">ุตุงูู ุงูุฑุจุญ</h3>
        <p class="stat-value">{{ formatCurrency(stats.monthlyProfit) }}</p>
        <span class="stat-trend positive">+15.7%</span>
      </div>
    </div>
  </div>

  <!-- Secondary Stats -->
  <div *ngIf="!loading && stats" class="secondary-stats">
    <div class="stat-item">
      <span class="stat-number">{{ stats.activeProjects }}</span>
      <span class="stat-text">ูุดุงุฑูุน ูุดุทุฉ</span>
    </div>
    <div class="stat-item warning">
      <span class="stat-number">{{ stats.overdueProjects }}</span>
      <span class="stat-text">ูุดุงุฑูุน ูุชุฃุฎุฑุฉ</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{ stats.pendingTasks }}</span>
      <span class="stat-text">ููุงู ูุนููุฉ</span>
    </div>
    <div class="stat-item danger">
      <span class="stat-number">{{ stats.overdueTasks }}</span>
      <span class="stat-text">ููุงู ูุชุฃุฎุฑุฉ</span>
    </div>
    <div class="stat-item">
      <span class="stat-number">{{ stats.pendingInvoices }}</span>
      <span class="stat-text">ููุงุชูุฑ ูุนููุฉ</span>
    </div>
    <div class="stat-item warning">
      <span class="stat-number">{{ stats.lowStockBooks }}</span>
      <span class="stat-text">ูุชุจ ููุฎูุถุฉ ุงููุฎุฒูู</span>
    </div>
  </div>

  <!-- Charts and Tables Section -->
  <div class="content-grid">
    <!-- Revenue Chart -->
    <div class="card chart-card">
      <div class="card-header">
        <h2 class="card-title">ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ</h2>
        <button class="btn-icon">
          <lucide-angular name="more-vertical" [size]="18"></lucide-angular>
        </button>
      </div>
      <div class="card-body">
        <div class="chart-placeholder">
          <p>๐ ูุฎุทุท ุงูุฅูุฑุงุฏุงุช (ูุชุทูุจ ููุชุจุฉ Charts)</p>
        </div>
      </div>
    </div>

    <!-- Top Books -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">ุงููุชุจ ุงูุฃูุซุฑ ูุจูุนุงู</h2>
        <a routerLink="/books" class="card-link">ุนุฑุถ ุงููู</a>
      </div>
      <div class="card-body">
        <div class="book-list" *ngIf="topBooks.length > 0; else noBooks">
          <div class="book-item" *ngFor="let book of topBooks; let i = index">
            <div class="book-rank">{{ i + 1 }}</div>
            <div class="book-cover">
              <img alt="" [src]="book.cover_image_url || 'assets/images/book-placeholder.png'"
                   [alt]="book.title"
                   loading="lazy">
            </div>
            <div class="book-info">
              <h4 class="book-title">{{ book.title }}</h4>
              <p class="book-sales">{{ book.sales }} ูุณุฎุฉ</p>
            </div>
            <div class="book-revenue">
              {{ formatCurrency(book.revenue) }}
            </div>
          </div>
        </div>
        <ng-template #noBooks>
          <p class="empty-state">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุจูุนุงุช ุญุงููุงู</p>
        </ng-template>
      </div>
    </div>

    <!-- Recent Activities -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">ุงููุดุงุทุงุช ุงูุฃุฎูุฑุฉ</h2>
      </div>
      <div class="card-body">
        <div class="activity-list" *ngIf="recentActivities.length > 0; else noActivities">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-icon" [ngClass]="activity.type">
              <lucide-angular [name]="activity.icon" [size]="18"></lucide-angular>
            </div>
            <div class="activity-content">
              <p class="activity-text">{{ activity.description }}</p>
              <span class="activity-time">{{ activity.time }}</span>
            </div>
          </div>
        </div>
        <ng-template #noActivities>
          <p class="empty-state">ูุง ุชูุฌุฏ ูุดุงุทุงุช ุญุฏูุซุฉ</p>
        </ng-template>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="card quick-links-card">
      <div class="card-header">
        <h2 class="card-title">ูุตูู ุณุฑูุน</h2>
      </div>
      <div class="card-body">
        <div class="quick-links-grid">
          <a routerLink="/customers" class="quick-link">
            <lucide-angular name="users" [size]="24"></lucide-angular>
            <span>ุงูุนููุงุก</span>
          </a>
          <a routerLink="/suppliers" class="quick-link">
            <lucide-angular name="truck" [size]="24"></lucide-angular>
            <span>ุงูููุฑุฏูู</span>
          </a>
          <a routerLink="/books" class="quick-link">
            <lucide-angular name="book-open" [size]="24"></lucide-angular>
            <span>ุงููุชุจ</span>
          </a>
          <a routerLink="/projects" class="quick-link">
            <lucide-angular name="folder" [size]="24"></lucide-angular>
            <span>ุงููุดุงุฑูุน</span>
          </a>
          <a routerLink="/tasks" class="quick-link">
            <lucide-angular name="check-square" [size]="24"></lucide-angular>
            <span>ุงูููุงู</span>
          </a>
          <a routerLink="/invoices" class="quick-link">
            <lucide-angular name="file-text" [size]="24"></lucide-angular>
            <span>ุงูููุงุชูุฑ</span>
          </a>
          <a routerLink="/accounting" class="quick-link">
            <lucide-angular name="dollar-sign" [size]="24"></lucide-angular>
            <span>ุงููุญุงุณุจุฉ</span>
          </a>
          <a routerLink="/calendar" class="quick-link">
            <lucide-angular name="calendar" [size]="24"></lucide-angular>
            <span>ุงูุชูููู</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
