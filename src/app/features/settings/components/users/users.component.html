<div class="settings-card users-card" dir="rtl">
  <div class="card-header">
    <div class="icon-box info">
      <lucide-angular name="users" [size]="24"></lucide-angular>
    </div>
    <div class="titles">
      <h2>إدارة المستخدمين</h2>
      <p>قائمة بجميع المستخدمين المسجلين وصلاحياتهم</p>
    </div>
    <div class="actions-head">
      <button class="btn-refresh" (click)="loadUsers()">
        <lucide-angular name="rotate-cw" [size]="18"></lucide-angular>
        تحديث
      </button>
    </div>
  </div>

  <div class="table-container">
    @if (loading) {
      <div class="loading-state">جاري تحميل المستخدمين...</div>
    } @else {
      <table class="users-table">
        <thead>
          <tr>
            <th>المستخدم</th>
            <th>البريد الإلكتروني</th>
            <th>الدور (الصلاحية)</th>
            <th>تاريخ التسجيل</th>
            <th>إجراءات</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users; track user.id) {
            <tr>
              <td>
                <div class="user-info">
                  <div class="avatar-circle">{{ user.full_name.charAt(0) }}</div>
                  <span>{{ user.full_name }}</span>
                </div>
              </td>
              <td class="email-col">{{ user.email }}</td>
              <td>
                <select
                  [ngModel]="user.role"
                  (ngModelChange)="updateRole(user, $event)"
                  class="role-select"
                  [class]="user.role">
                  @for (role of roles; track role.value) {
                    <option [value]="role.value">{{ role.label }}</option>
                  }
                </select>
              </td>
              <td class="date-col">{{ user.created_at | date:'mediumDate' }}</td>
              <td>
                <button class="btn-icon delete" (click)="deleteUser(user)" title="حذف المستخدم">
                  <lucide-angular name="trash-2" [size]="18"></lucide-angular>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
  </div>
</div>
